# ch8 의존성 관리하기

충분히 협력적이면서 유연한 객체를 만들기 위해 의존성을 관리하는 방법을 살펴본다.

### 01 의존성 이해하기

##### 변경과 의존성

의존성
- 객체가 협력하기 위해 다른 객체를 필요로 할 때 두 객체 사이에 의존성이 발생한다.
- 의존성은 실행 시점과 구현 시점에 다른 의미를 가진다.
  - 실행 시점: 의존하는 객체가 정상적으로 동작하기 위해서는 실행 시에 의존 대상 객체가 반드시 존재해야 한다.
  - 구현 시점: 의존 대상 객체가 변경될 경우 의존하는 객체도 함께 변경된다.
- 의존성은 방향성을 가지며 항상 단방향성이다.
- 의존성은 변경에 의한 영향의 전파 가능성을 암시한다.

의존성 전이
- 의존하는 대상이 의존하는 대상과 어떤 객체 사이에 자동적으로 의존하게 된다는 것
- 직접 의존성: 한 요소가 다른 요소에 직접 의존하는 경우
- 간접 의존성: 직접적인 관계는 존재하지 않지만 의존성 전이에 의해 전파되는 경우

런타임 의존성과 컴파일타임 의존성
- 런타임 의존성: 객체 사이에 의존성
- 컴파일타임 의존성: 클래스 사이에 의존성
- 유연하고 재사용 가능한 코드를 설계하기 위해서는 두 종류의 의존성을 서로 다르게 만들어야 한다.

컨텍스트 독립성
- 클래스가 어떤 문맥에 사용될 것인지, 문맥에 대해 최소한의 가정만으로 이뤄져 있다면 다른 문맥에서 재사용하기가 더 수월해진다.
- 구체 클래스에 대해 의존하는 것은 클래스의 인스턴스가 어떤 문맥에서 사용될 것인지 구체적으로 명시하는 것과 같다.

의존성 해결하기
- 의존성 해결: 컴파일타임 의존성을 실행 컨텍스트에 맞게 적절한 런타임 의존성으로 교체하는 것
  - 객체를 생성하는 시점에 생성자를 통해 의존성 해결
  - 객체 생성 후 setter 메서드를 통해 의존성 해결
  - 메서드 실행 시 인자를 이용해 의존성 해결

### 02 유연한 설계

의존성과 결합도
- 의존성은 객체들의 협력을 가능하게 만드는 매개체라는 관점에서 바람직하나 과하면 문제가 될 수 있다.
- 바람직한 의존성은 재사용성과 관련이 있다.
- 결합도: 의존성을 가리키는 다른 용어
  - 느슨한 결합도, 약한 결합도: 의존성이 바람직함, 설계를 재사용하기 쉽다.
  - 단단한 결합도, 강한 결합도: 의존성이 바람직하지 못함, 설계를 재사용하기 어렵다.

지식이 결합을 낳는다
- 결합도의 정도는 한 요소가 의존하고 있는 다른 요소에 대해 알고 있는 정보의 양으로 결정된다.

추상화에 의존하라
- 어떤 양상, 세부사항, 구조를 좀 더 명확하게 이해하기 위해 특정 절차나 물체를 의도적으로 생략하거나 감춤으로써 복잡도를 극복하는 방법
- 추상화 목록
  - 구체 클래스 의존성
  - 추상 클래스 의존성
  - 인터페이스 의존성

명시적인 의존성
- 의존성이 명시적이지 않으면 
  - 내부 구현을 직접 살펴볼 수 밖에 없다.
  - 다른 컨텍스트에서 재사용하기 위해 내부 구현을 직접 변경해야 한다.
- 의존성이 명시적이어야
  - 컴파일타임 의존성을 적절한 런타임 의존성으로 교체할 수 있다.
  - 설계가 유연하고 재사용 가능해진다.

new는 해롭다
- 결합도가 높아진다.
  - 구체 클래스의 이름을 직접 기술해야 한다: 구체 클래스에 의존한다.
  - 어떤 인자를 생성자를 쓰는지 알아야한다: 클라이언트가 알아야할 지식의 양이 늘어난다.
- 해결방법
  - 인스턴스를 생성하는 로직과 생성한 인스턴스를 사용하는 로직을 분리한다.

가끔은 생성해도 무방하다
- 주로 협력하는 기본 객체를 설정하고 싶을 경우 유용하다.
  - 결합도와 사용성의 트레이프오프

표준 클래스에 대한 의존은 해롭지 않다
- 표준 클래스는 수정될 확률이 0 에 가깝기 때문에 결합도가 높아도 문제가 되지 않는다.

컨텍스트 확장하기
- 추상화에 의존하고 생성자로 의존성을 명시하여 책임을 외부로 옮김
- 외부에서 컨텍스트를 유연하게 확장할 수 있다.

조합 가능한 행동
- 유연하고 재사용 가능한 설계는
  - 생성하는 코드만 보더라도 어떤 행동을 할 지 쉽게 예상하고 이해할 수 있다.
  - 응집도 높은 객체들을 다양한 방식으로 연결하여 기능을 확장할 수 있다.
  - 작은 객체들의 행동을 조합하여 새로운 행동을 이끌어낼 수 있다.
  - 이런 설계의 핵심은 의존성을 관리하는 것이다.